//
// Authors : R. Ete (remi.ete@cern.ch), A. Pingault (antoine.pingault@ugent.be)
// 
// Config file for dqm4hep job interface.
// Used for siwecal + sdhcal beam test at CERN SPS - June 2016
// 
// One PC is reserved to DAQ (lyosdhcal9).
// On this host only 1 DQM process is running : the shared memory proxy.
//
// 
// lyosdhcal10 runs the main server application needed for the DQM setup :
//  * 2 data collectors
//  * 1 monitor element collector
//  * 1 run control server
// 
// lyosdhcal7 and 12 run the online analysis.
//
// In order to not interferate with the DAQ process managment,
// an other dns (DIM) should be created on lyosdhcal10 only for dimjc deamon server applications
// For all other processes the dns will be the same as the DAQ one (needed for slow control module)
//

{
    "VARS" :
    {
	"GLOBAL":
	{
	    "DAQ_DNS_NODE" : "lyosdhcal9", // not used. Here just for your information
	    "DQM_DNS_NODE" : "lyosdhcal10",
	    // paths
	    "DQM4HEP_DIR" : "/opt/dqmsoftware/dqm4hep",
	    "DQM4HEP_BIN_DIR" : "${DQM4HEP_DIR}/bin",
	    "DQM4HEP_DLL_DIR" : "${DQM4HEP_DIR}/lib",
	    "DQMSDHCAL_DIR" : "/opt/dqmsoftware/dqmsdhcal",
	    "DQMSDHCAL_BIN_DIR" : "${DQMSDHCAL_DIR}/bin",
	    "DQMSDHCAL_DLL_DIR" : "${DQMSDHCAL_DIR}/lib",
	    "DQMSDHCAL_CONFIG_DIR" : "${DQMSDHCAL_DIR}/config",
	    "DQM4ILC_DLL" : "${DQM4HEP_DLL_DIR}/libDQM4ILC.so",
	    // process variables
	    "EVENT_STREAMER_NAME" : "LCIOStreamer",
	    "RUN_CONTROL_NAME" : "SDHCALRunControl",
	    "RUN_CONTROL_PORT" : "8082",
	    "EVENT_COLLECTOR_NAME" : "event_collector",
	    "EVENT_COLLECTOR_NAME_2" : "event_collector_2",
	    "ME_COLLECTOR_NAME" : "me_collector",
	    // "LCIO_FILE_NAME" : "/data/srv02/RAID6/SPS_10_2015/Compressed/DHCAL_730926_SO.slcio", // for local test during development
	    	    "LCIO_FILE_NAME" : "/data/NAS/June2016/DHCAL_732695_I0_0.slcio", // for local test during development
	    //"LCIO_FILE_NAME" : "/data/NAS/Avril2015/DHCAL_728455_I0_0.slcio", // for local test during development
	    // "LCIO_FILE_NAME" : "/data/NAS/October2015/DHCAL_730926_I0_0.slcio", // for local test during development	    "SHM_APP_NAME" : "SDHCALShmReader",
	    "SHM_DRIVER_DIR" : "/dev/shm/monitor/offline",
	    //"SHM_DRIVER_CONFIG_FILE" : "${DQMSDHCAL_CONFIG_DIR}/SiWECal_SDHCAL_SPS_06_2016.xml", // must be on lyosdhcal9 with DAQ
	    "SHM_DRIVER_CONFIG_FILE" : "${DQMSDHCAL_CONFIG_DIR}/SDHCAL_SPS_10_2015_OFFLINE.xml", // must be on lyosdhcal9 with DAQ
	    "LOGGER_FILE" : "/opt/dqmsoftware/dqm4hep/conf/defaultLoggerConfig.xml",
	    "GEOMETRY_FILE_NAME" : "/opt/dqmsoftware/dqmsdhcal/config/geometry_PS_06_2015.xml"
	}
    },
    "HOSTS" :
    {
	// only one process on this host (the DAQ computer)
	"lyosdhcal9":[
	    {
		"NAME":"ShmDriver",
		"ARGS" : [
		    "--steering-file", "${SHM_DRIVER_CONFIG_FILE}",
		    "--application-name", "${SHM_APP_NAME}",
		    "--parameter", "global.shmdriver.directory=${SHM_DRIVER_DIR}",
		    "--parameter", "global.runcontrol.name=${RUN_CONTROL_NAME}",
		    "--parameter", "global.eventclientlist.eventclient[0].parameter.collectorName=${EVENT_COLLECTOR_NAME}",
		    "--parameter", "global.eventclientlist.eventclient[1].parameter.collectorName=${EVENT_COLLECTOR_NAME_2}",
		    "--parameter", "global.eventstreamer.plugin=${EVENT_STREAMER_NAME}",
		    "--parameter", "evbprocessors.evbprocessor[1].electronicsMapping.parameter.ReadFromDB=false",
		    "--parameter", "evbprocessors.evbprocessor[1].electronicsMapping.parameter.GeometryFileName=${GEOMETRY_FILE_NAME}",
		    "-v", "DEBUG",
		    "--logger-config", "${LOGGER_FILE}"
		],
		"ENV" : [
		    "DIM_DNS_NODE=${DQM_DNS_NODE}",
		    "DQM4HEP_PLUGIN_DLL=${DQM4ILC_DLL}:${DQMSDHCAL_DLL_DIR}/libDQMSDHCALCommon.so"
		],
		"PROGRAM" : "${DQM4HEP_BIN_DIR}/dqm4hep_start_shm_driver"
	    }
	],
	"lyosdhcal12": [
	    {
		"NAME":"DQMRunControl",
		"ARGS" : [
		    "--run-control-name", "${RUN_CONTROL_NAME}",
//		    "--http-port", "${RUN_CONTROL_PORT}",
		    "--verbosity", "DEBUG",
		    "--logger-config", "${LOGGER_FILE}"
		],
		"ENV" : [
		    "DIM_DNS_NODE=${DQM_DNS_NODE}"
		],
		"PROGRAM" : "${DQM4HEP_BIN_DIR}/dqm4hep_start_run_control_server"
	    },
	    {
		"NAME":"DQMRunInterface",
		"ARGS" : [
		    "--run-control-name", "${RUN_CONTROL_NAME}",
		    "--verbosity", "DEBUG",
		    "--logger-config", "${LOGGER_FILE}"
		],
		"ENV" : [
		    "DIM_DNS_NODE=${DQM_DNS_NODE}"
		],
		"PROGRAM" : "${DQM4HEP_BIN_DIR}/dqm4hep_start_run_control_interface"
	    },
	    {
		"NAME":"ShmDriver",
		"ARGS" : [
		    "--steering-file", "${SHM_DRIVER_CONFIG_FILE}",
		    "--application-name", "${SHM_APP_NAME}",
		    "--parameter", "global.shmdriver.directory=${SHM_DRIVER_DIR}",
		    "--parameter", "global.runcontrol.name=${RUN_CONTROL_NAME}",
		    "--parameter", "global.eventclientlist.eventclient[0].parameter.collectorName=${EVENT_COLLECTOR_NAME}",
		   // "--parameter", "global.eventclientlist.eventclient[1].parameter.collectorName=${EVENT_COLLECTOR_NAME_2}",
		    "--parameter", "global.eventstreamer.plugin=${EVENT_STREAMER_NAME}",
		    "--parameter", "evbprocessors.evbprocessor[1].electronicsMapping.parameter.ReadFromDB=false",
		    "--parameter", "evbprocessors.evbprocessor[1].electronicsMapping.parameter.GeometryFileName=${GEOMETRY_FILE_NAME}",
		    "-v", "DEBUG",
		    "--logger-config", "${LOGGER_FILE}"
		],
		"ENV" : [
		    "DIM_DNS_NODE=${DQM_DNS_NODE}",
		    "DQM4HEP_PLUGIN_DLL=${DQM4ILC_DLL}:${DQMSDHCAL_DLL_DIR}/libDQMSDHCALCommon.so"
		],
		"PROGRAM" : "${DQM4HEP_BIN_DIR}/dqm4hep_start_shm_driver"
	    },
	     {
		"NAME":"ShmPublisher",
		"ARGS" : [
		    "--lcio-files", "${LCIO_FILE_NAME}",
		    "--monitoring-directory", "${SHM_DRIVER_DIR}",
		    // "--detector-id", "100",
		    // "--xdaqshift", "24",
		    "--sleep-time", "10000",
		    "--collection-name", "RU_XDAQ",
		    "--skip-event", "3",
		    "--verbosity", "DEBUG"
		],
		"ENV" : [
		],
		"PROGRAM" : "${DQMSDHCAL_BIN_DIR}/dqmsdhcal_start_shm_publisher"                    
	    }
	],
	// lyosdhcal10 runs the main server application for the dqm setup
	"lyosdhcal10": [
	    {
		"NAME":"EventCollector",
		"ARGS" : [
		    "--collector-name", "${EVENT_COLLECTOR_NAME}",
		    "--streamer", "${EVENT_STREAMER_NAME}",
		    "--verbosity", "DEBUG",
		    "--logger-config", "${LOGGER_FILE}"
		],
		"ENV" : [
		    "DQM4HEP_PLUGIN_DLL=${DQM4ILC_DLL}",
		    "DIM_DNS_NODE=${DQM_DNS_NODE}"
		],
		"PROGRAM" : "${DQM4HEP_BIN_DIR}/dqm4hep_start_event_collector"
	    },
	    {
		"NAME":"EventCollector_2",
		"ARGS" : [
		    "--collector-name", "${EVENT_COLLECTOR_NAME_2}",
		    "--streamer", "${EVENT_STREAMER_NAME}",
		    "--verbosity", "DEBUG",
		    "--logger-config", "${LOGGER_FILE}"
		],
		"ENV" : [
		    "DQM4HEP_PLUGIN_DLL=${DQM4ILC_DLL}",
		    "DIM_DNS_NODE=${DQM_DNS_NODE}"
		],
		"PROGRAM" : "${DQM4HEP_BIN_DIR}/dqm4hep_start_event_collector"
	    },
	    {
		"NAME":"MonitorElementCollector",
		"ARGS" : [
		    "--collector-name", "${ME_COLLECTOR_NAME}",
		    "--verbosity", "DEBUG",
		    "--logger-config", "${LOGGER_FILE}"
		],
		"ENV" : [
		    "DIM_DNS_NODE=${DQM_DNS_NODE}"
		],
		"PROGRAM" : "${DQM4HEP_BIN_DIR}/dqm4hep_start_monitor_element_collector"
	    }
	],
	"lyosdhcal7":[
	    // {
	    // 	"NAME":"LcioFileService",
	    // 	"ARGS" : [
	    // 	    "--lcio-files", "${LCIO_FILE_NAME}",
	    // 	    "--collector-name", "${EVENT_COLLECTOR_NAME}",
	    // 	    "--verbosity", "DEBUG",
	    // 	    "--sleep-time", "100",
	    // 	    "--skip-event", "1",
	    // 	    "--logger-config", "${LOGGER_FILE}"
	    // 	],
	    // 	"ENV" : [
	    // 	    "DIM_DNS_NODE=${DQM_DNS_NODE}"
	    // 	],
	    // 	"PROGRAM" : "${DQM4HEP_BIN_DIR}/dqm4hep_start_lcio_file_service"
	    // },
	    {
		"NAME":"AsicAnalysisModule",
		"ARGS" : [
		    "--verbosity", "DEBUG",
		    "--steering-file", "${DQMSDHCAL_CONFIG_DIR}/AsicAnalysisModule.xml",
		    "--parameter", "cycle.type=TimerCycle",
		    "--parameter", "cycle.value=10", // unit seconds
		    "--parameter", "module.name=AsicEfficiencies",
		    "--parameter", "network.runcontrol.name=${RUN_CONTROL_NAME}",
		    "--parameter", "network.eventcollector.parameter.collectorName=${EVENT_COLLECTOR_NAME}",
		    "--parameter", "network.eventcollector.parameter.streamerName=${EVENT_STREAMER_NAME}",
		    "--parameter", "network.monitorelementcollector.name=${ME_COLLECTOR_NAME}",
		    "--parameter", "module.electronicsMapping.parameter.ReadFromDB=false",
		    "--parameter", "module.electronicsMapping.parameter.GeometryFileName=${GEOMETRY_FILE_NAME}",
		    "--logger-config", "${LOGGER_FILE}"
		],
		"ENV" : [
		    "DIM_DNS_NODE=${DQM_DNS_NODE}",
		    "DQM4HEP_PLUGIN_DLL=${DQM4ILC_DLL}:${DQMSDHCAL_DLL_DIR}/libAsicAnalysisModule.so"
		],
		"PROGRAM" : "${DQM4HEP_BIN_DIR}/dqm4hep_start_analysis_module"	
	    },
	    {
		"NAME":"EventDisplayModule",
		"ARGS" : [
		    "--verbosity", "DEBUG",
		    "--steering-file", "${DQMSDHCAL_CONFIG_DIR}/EventDisplayModule.xml",
		    "--parameter", "module.name=EventDisplay",
		    "--parameter", "network.runcontrol.name=${RUN_CONTROL_NAME}",
		    "--parameter", "network.eventcollector.parameter.collectorName=${EVENT_COLLECTOR_NAME}",
		    "--parameter", "network.eventcollector.parameter.streamerName=${EVENT_STREAMER_NAME}",
		    "--parameter", "network.monitorelementcollector.name=${ME_COLLECTOR_NAME}",
		    "--logger-config", "${LOGGER_FILE}"
		],
		"ENV" : [
		    "DIM_DNS_NODE=${DQM_DNS_NODE}",
		    "DQM4HEP_PLUGIN_DLL=${DQM4ILC_DLL}:${DQMSDHCAL_DLL_DIR}/libEventDisplayModule.so"
		],
		"PROGRAM" : "${DQM4HEP_BIN_DIR}/dqm4hep_start_analysis_module"
	    },
	    {
		"NAME":"HoughTransformModule",
		"ARGS" : [
		    "--verbosity", "DEBUG",
		    "--steering-file", "${DQMSDHCAL_CONFIG_DIR}/HoughTransformModule.xml",
		    "--parameter", "network.runcontrol.name=${RUN_CONTROL_NAME}",
		    "--parameter", "module.name=ShowerTracking",
		    "--parameter", "network.eventcollector.parameter.collectorName=${EVENT_COLLECTOR_NAME}",
		    "--parameter", "network.eventcollector.parameter.streamerName=${EVENT_STREAMER_NAME}",
		    "--parameter", "network.monitorelementcollector.name=${ME_COLLECTOR_NAME}",
		    "--logger-config", "${LOGGER_FILE}"
		],
		"ENV" : [
		    "DIM_DNS_NODE=${DQM_DNS_NODE}",
		    "DQM4HEP_PLUGIN_DLL=${DQM4ILC_DLL}:${DQMSDHCAL_DLL_DIR}/libHoughTransformModule.so"
		],
		"PROGRAM" : "${DQM4HEP_BIN_DIR}/dqm4hep_start_analysis_module"
	    },
	    {
		"NAME":"ParticleIDModule",
		"ARGS" : [
		    "--verbosity", "DEBUG",
		    "--steering-file", "${DQMSDHCAL_CONFIG_DIR}/ParticleIDModule.xml",
		    "--parameter", "module.name=ParticleIDInfo",
		    "--parameter", "network.runcontrol.name=${RUN_CONTROL_NAME}",
		    "--parameter", "network.eventcollector.parameter.collectorName=${EVENT_COLLECTOR_NAME}",
		    "--parameter", "network.eventcollector.parameter.streamerName=${EVENT_STREAMER_NAME}",
		    "--parameter", "network.monitorelementcollector.name=${ME_COLLECTOR_NAME}",
		    "--logger-config", "${LOGGER_FILE}"
		],
		"ENV" : [
		    "DIM_DNS_NODE=${DQM_DNS_NODE}",
		    "DQM4HEP_PLUGIN_DLL=${DQM4ILC_DLL}:${DQMSDHCAL_DLL_DIR}/libParticleIDModule.so"
		],
		"PROGRAM" : "${DQM4HEP_BIN_DIR}/dqm4hep_start_analysis_module"
	    },
	    {
		"NAME":"BeamAnalysisModule",
		"ARGS" : [
		    "--verbosity", "DEBUG",
		    "--steering-file", "${DQMSDHCAL_CONFIG_DIR}/BeamAnalysisModule.xml",
		    "--parameter", "module.name=BeamInfo",
		    "--parameter", "network.runcontrol.name=${RUN_CONTROL_NAME}",
		    "--parameter", "network.eventcollector.parameter.collectorName=${EVENT_COLLECTOR_NAME}",
		    "--parameter", "network.eventcollector.parameter.streamerName=${EVENT_STREAMER_NAME}",
		    "--parameter", "module.eventHelper.electronicsMapping.parameter.ReadFromDB=false",
		    "--parameter", "module.eventHelper.electronicsMapping.parameter.GeometryFileName=${GEOMETRY_FILE_NAME}",
		    "--parameter", "network.monitorelementcollector.name=${ME_COLLECTOR_NAME}",
		    "--logger-config", "${LOGGER_FILE}"
		],
		"ENV" : [
		    "DIM_DNS_NODE=${DQM_DNS_NODE}",
		    "DQM4HEP_PLUGIN_DLL=${DQM4ILC_DLL}:${DQMSDHCAL_DLL_DIR}/libBeamAnalysisModule.so"
		],
		"PROGRAM" : "${DQM4HEP_BIN_DIR}/dqm4hep_start_analysis_module"
	    },
	    {
		"NAME":"HitAnalysisModule",
		"ARGS" : [
		    "--verbosity", "DEBUG",
		    "--steering-file", "${DQMSDHCAL_CONFIG_DIR}/HitAnalysisModule.xml",
		    "--parameter", "module.name=SDHCALHitsAnalysis",
		    "--parameter", "network.runcontrol.name=${RUN_CONTROL_NAME}",
		    "--parameter", "network.eventcollector.parameter.collectorName=${EVENT_COLLECTOR_NAME_2}",
		    "--parameter", "network.eventcollector.parameter.streamerName=${EVENT_STREAMER_NAME}",
		    "--parameter", "network.monitorelementcollector.name=${ME_COLLECTOR_NAME}",
		    "--parameter", "module.eventHelper.electronicsMapping.parameter.ReadFromDB=false",
		    "--parameter", "module.eventHelper.electronicsMapping.parameter.GeometryFileName=${GEOMETRY_FILE_NAME}",
		    "--parameter", "cycle.type=EventCounterCycle",
		    "--parameter", "cycle.value=5",
		    
		    "--logger-config", "${LOGGER_FILE}"
		],
		"ENV" : [
		    "DIM_DNS_NODE=${DQM_DNS_NODE}",
		    "DQM4HEP_PLUGIN_DLL=${DQM4ILC_DLL}:${DQMSDHCAL_DLL_DIR}/libHitAnalysisModule.so"
		],
		"PROGRAM" : "${DQM4HEP_BIN_DIR}/dqm4hep_start_analysis_module"
	    },
	    {
		"NAME":"RawAnalysisModule",
		"ARGS" : [
		    "--verbosity", "DEBUG",
		    "--steering-file", "${DQMSDHCAL_CONFIG_DIR}/RawAnalysisModule.xml",
		    "--parameter", "module.name=RawDataAnalysis",
		    "--parameter", "network.runcontrol.name=${RUN_CONTROL_NAME}",
		    "--parameter", "network.eventcollector.parameter.collectorName=${EVENT_COLLECTOR_NAME}",
		    "--parameter", "network.eventcollector.parameter.streamerName=${EVENT_STREAMER_NAME}",
		    "--parameter", "network.monitorelementcollector.name=${ME_COLLECTOR_NAME}",
		    "--parameter", "module.eventHelper.electronicsMapping.parameter.ReadFromDB=false",
		    "--parameter", "module.eventHelper.electronicsMapping.parameter.GeometryFileName=${GEOMETRY_FILE_NAME}",
		    "--parameter", "module.electronicsMapping.parameter.ReadFromDB=false",
		    "--parameter", "module.electronicsMapping.parameter.GeometryFileName=${GEOMETRY_FILE_NAME}",
		    "--logger-config", "${LOGGER_FILE}"
		],
		"ENV" : [
		    "DIM_DNS_NODE=${DQM_DNS_NODE}",
		    "DQM4HEP_PLUGIN_DLL=${DQM4ILC_DLL}:${DQMSDHCAL_DLL_DIR}/libRawAnalysisModule.so"
		],
		"PROGRAM" : "${DQM4HEP_BIN_DIR}/dqm4hep_start_analysis_module"
	    },
	    {
		"NAME":"SlowControlModule",
		"ARGS" : [
		    "--verbosity", "DEBUG",
		    "--steering-file", "${DQMSDHCAL_CONFIG_DIR}/SlowControlModule.xml",
		    "--parameter", "module.name=SlowControl",
		    "--parameter", "monitorelementcollector.name=${ME_COLLECTOR_NAME}",
		    "--logger-config", "${LOGGER_FILE}"
		],
		"ENV" : [
		    "DIM_DNS_NODE=${DQM_DNS_NODE}",
		    "DQM4HEP_PLUGIN_DLL=${DQM4ILC_DLL}:${DQMSDHCAL_DLL_DIR}/libSlowControlModule.so"
		],
		"PROGRAM" : "${DQM4HEP_BIN_DIR}/dqm4hep_start_standalone_module"
	    }
	]
    }
}
